

Code in this directory is used to process the data generated by scCAT-seq, C1 CAGE, BAT-seq, etc. Fastq file is needed and the output file format is "BED". Each Row represents read in corresponding position.

Then BED file as input is needed to call peak using CAGEr R package.

---

# data processing for 5' data
The workflows of data of scCAT-seq 5', C1 CAGE, C1 STRT and Arguel et al. are similar. Here is the scCAT-seq 5' data processing workflow. To see detail imformation of other data processing, please see C1_CAGE_5_data_processing.sh, C1_STRT_5_data_processing.sh and Arguel_et_al_5_data_processing.sh.

## Prepare

Before process the data, we bulid some directory and move the script to "script_and_log" directory: 

```
mkdir ~/zjw/20190109
mkdir ~/zjw/20190109/5cap_read_with_tag
mkdir ~/zjw/20190109/trim_GTGGTATCAACGCAGAGTACAT
mkdir ~/zjw/20190109/mapping_output
mkdir ~/zjw/20190109/extract_uniquely_map
mkdir ~/zjw/20190109/split_plus_minus
mkdir ~/zjw/20190109/extract_mismatch
mkdir ~/zjw/20190109/final_out
mkdir ~/zjw/20190109/script_and_log
mv extractmismatch_plus_5'.py ~/zjw/20190109/script_and_log
mv extractmismatch_plus_3'.py ~/zjw/20190109/script_and_log
cd ~/zjw/20190109/script_and_log
```

## Find reads with TSO primer


## Trim TSO primer but retain GGG

## Mapping

## Split reads aligned to plus stand and minus strand

## Extract reads with mismatch at 5'

## Convert SAM to BED

## Remove useless end

1) Find reads with TSO primer: Reads with TSO primer sequence at 5' are considered to further processing.
2) Trim TSO primer but retain GGG: TSO primer is trimmed. "GGG" was used to remove reads with strand invasion.
3) Mapping: Reads are aligned to mouse genome (mm10) or human genome (hg38). We only select uniquely mapped reads.
4) Split reads aligned to plus stand and minus strand: This step is to prepare for step 5.
5) Extract reads with mismatch at 5': The template-switching (TS) oligonucleotide may hybridize to the first strand cDNA due to sequence complementarity before the RT has finished polymerizing. Artifact that introduced by incomplete reverse transcription process is called strand invasion. We suppose that if "GGG" aligned, reads are strand invasion drivern artifacts. If "GGG" don't aligned, reads are derived from complete reverse transcription.
6) Convert SAM to BED: As BED format file can be used as input for CAGEr R package, we generate SAM to BED.
7) Generate CAGEset object in R: See R script generate_CAGEset_5'.R 

---

The workflows of data of scCAT-seq 3' and BAT-seq are similar. Here is the scCAT-seq 5' data processing workflow. To see detail imformation of BAT-seq data processing, please see BAT-seq_3_data_processing.sh.

1) Find reads with oligo(dT) primer: Reads with oligo(dT) primer sequence at 5'. We define reads with oligo(dT) primer sequence at 5' as R1 reads.
2) Find R2 reads: Perl script cmpfastq_pe.pl is used to find R2 reads which its corresponding R1 reads with oligo(dT) primes.
3) Trim A10 but retain A5 at R2 reads: Poly A sequences in the end of R2 were further trimmed with 5 A bases left at the 3â€™ side. "AAAAA" was used to remove reads with internal priming.
4) Mapping: Reads are aligned to mouse genome (mm10). We only select uniquely mapped reads.
5) Split reads aligned to plus stand and minus strand: This step is to prepare for step 6.
6) Extract reads with mismatch at 3': Oligo(dT) primers can also anneal to internal A-rich sequences, a phenomenon called internal priming, leading to the generation of artifact. If "AAAAA" aligned, reads are internal priming drivern artifacts. If "GGG" don't aligned, reads are supposed to contain true polyA site.
7) Convert SAM to BED: As BED format file can be used as input for CAGEr R package, we generate SAM to BED.
8) Generate CAGEset object in R: See R script generate_CAGEset_3'.R

